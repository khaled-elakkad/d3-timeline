!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3-axis"),require("d3-array"),require("d3-time-format"),require("d3-time"),require("d3-scale"),require("d3-selection"),require("d3-zoom"),require("d3-scale-chromatic")):"function"==typeof define&&define.amd?define(["d3-axis","d3-array","d3-time-format","d3-time","d3-scale","d3-selection","d3-zoom","d3-scale-chromatic"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).D3Timelines=e(t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t.d3)}(this,(function(t,e,n,r,i,a,o,l){"use strict";return function(){var c=["circle","rect"],s=function(){},u=function(){},f=function(){},d=function(){},m=function(){},h=function(t){return t},g=0,p=function(){},x=function(){},v="bottom",k=null,w=null,y=null,b=null,_={format:n.timeFormat("%I %p"),tickTime:r.timeHour,tickInterval:1,tickSize:6,tickValues:null},T=!1,A="white",F={},B=i.scaleOrdinal(l.schemeCategory10),E=null,S="rect",z=0,q=0,I=0,C={left:30,right:30,top:30,bottom:30},Y=5,M=!1,V=!1,D=!1,L=!1,N=!1,O=20,H=5,P=60,j=!0,R=!1,Z=!1,W=!1,X={stroke:"stroke-dasharray",spacing:"4 10"},G={marginTop:25,marginBottom:0,width:1,color:B},J=!1,K={marginTop:25,marginBottom:0,width:1,color:B},Q="timeline-border-line",U=!1,$=!1,tt=!1,et="timeline-xAxis",nt=null,rt=null,it=function(t){var e=C.left-P,n=(k-C.left)/6,r=k-C.right-n+P,i=t.append("g").attr("class","axis").attr("transform","translate(0, 20)");tt&&function(t){var e=z.getFullYear();z.getFullYear()!=I.getFullYear()&&(e=z.getFullYear()+"-"+I.getFullYear()),t.append("text").attr("transform","translate(20, 0)").attr("x",0).attr("y",14).attr("class","calendarYear").text(e)}(i),i.append("text").attr("transform","translate("+e+", 0)").attr("x",0).attr("y",14).attr("class","chevron").text("<").on("click",(function(){return p(z,F)})),i.append("text").attr("transform","translate("+r+", 0)").attr("x",0).attr("y",14).attr("class","chevron").text(">").on("click",(function(){return x(I,F)}))},at=function(t,e,n){t.insert("rect").attr("class","row-green-bar").attr("x",e).attr("width",k).attr("y",n).attr("height",O).attr("fill",A)};function ot(n){var r=n.node().getBoundingClientRect(),l=a.select(n.node()),c=n.append("g").attr("class","container"),p={},x=1,A=0,P=0;!function(){if(k||r.width){if(!k&&r.width)try{k=r.width}catch(t){console.log(t)}}else try{if(!(k=l.node().attr("width")))throw"width of the timeline is not set. As of Firefox 27, timeline().with(x) needs to be explicitly set in order to render"}catch(t){console.log(t)}}(),D&&c.each((function(t,e){var n=0;t.forEach((function(t,e){t.times.forEach((function(t,r){0===e&&0===r?(n=t.starting_time,t.starting_time=0,t.ending_time=t.ending_time-n):(t.starting_time=t.starting_time-n,t.ending_time=t.ending_time-n)}))}))})),(M||0===I||0===z)&&(c.each((function(t,e){t.forEach((function(t,e){M&&-1==Object.keys(p).indexOf(e)&&(p[e]=x,x++),t.times.forEach((function(t,e){0===z&&(t.starting_time<A||0===A&&!1===D)&&(A=t.starting_time),0===I&&t.ending_time>P&&(P=t.ending_time)}))}))})),0===I&&(I=P),0===z&&(z=A));var tt=1/(I-z)*(k-C.left-C.right);"bottom"==v?rt=t.axisBottom():"top"==v&&(rt=t.axisTop()),L?(nt=i.scaleLinear().domain([z,I]).range([C.left,k-C.right]),rt.scale(nt).tickFormat((function(t){var e=Math.floor(t/86400),n=Math.floor((t-86400*e)/3600),r=Math.floor((t-86400*e-3600*n)/60),i=t-86400*e-3600*n-60*r,a="";return i&&(a=i+"s"),r&&(a=r+"m "+a),n&&(a=n+"h "+a),e&&(a=e+"d "+a),a})).tickValues(e.range(0,I,86400))):(nt=i.scaleTime().domain([z,I]).range([C.left,k-C.right]),rt.scale(nt).tickFormat(_.format).tickSize(_.tickSize)),null!==_.tickValues?rt.tickValues(_.tickValues):rt.tickArguments(_.numTicks||[_.tickTime,_.tickInterval]);var ot=c.append("g").attr("class","view");c.each((function(t,e){F=t,t.forEach((function(e,r){var i=e.times;i.forEach((function(t){t.name=e.name}));var o=void 0!==e.label;if(void 0!==e.id&&console.warn("d3Timeline Warning: Ids per dataset is deprecated in favor of a 'class' key. Ids are now per data element."),b&&function(t,e,n,r,i){var a=(O+H)*t[e]+C.top;n.selectAll("svg").data(r).enter().insert("rect",":first-child").attr("class","row-green-bar").attr("x",N?0:C.left).attr("width",N?k:k-C.right-C.left).attr("y",a).attr("height",O).attr("fill",b instanceof Function?b(i,e):b)}(p,r,c,i,e),ot.selectAll("svg").data(i).enter().append((function(t,e){return document.createElementNS(a.namespaces.svg,"display"in t?t.display:S)})).attr("x",mt).attr("y",m).attr("width",(function(t,e){return(t.ending_time-t.starting_time)*tt})).attr("cy",(function(t,e){return m()+O/2})).attr("cx",mt).attr("r",O/2).attr("height",O).style("fill",(function(t,n){var i;return t.color?t.color:E?(i=t[E],B(i||e[E])):B(r)})).on("mousemove",(function(t,n){s(t,n,r,e)})).on("mouseover",(function(t,n){u(t,n,r,e)})).on("mouseout",(function(t,n){f(t,n,r,e)})).on("click",(function(t,n){var i=a.pointer(t),o=a.select(this).node(),l="text#"+o.id+".textnumbers",c=a.select(l).node();d(t,n,r,e,c,o,nt.invert(i[0]))})).attr("class",(function(t,n){return e.class?"timelineSeries_"+e.class:"timelineSeries_"+r})).attr("id",(function(t,n){return e.id&&!t.id?"timelineItem_"+e.id:t.id?t.id:"timelineItem_"+r+"_"+n})),ot.selectAll("svg").data(i).enter().append("text").attr("class","textlabels").attr("id",(function(t){return t.id})).attr("x",(function(t,e){return gt(t,e,t.label,".textlabels")})).attr("y",x()-g).text((function(t){return t.label})).on("click",(function(t,n){var i=a.pointer(t),o=this.id,l="text#"+o+".textnumbers",c=a.select(l).node(),s="rect#"+o,u=a.select(s).node();d(t,n,r,e,c,u,nt.invert(i[0]))})),ot.selectAll("svg").data(i).enter().filter((function(t){return void 0!==t.labelNumber})).append("text").attr("class","textnumbers").attr("id",(function(t){return t.id})).attr("x",(function(t,e){return gt(t,e,t.labelNumber,".textnumbers")})).attr("y",x).text((function(t){return t.labelNumber})).on("click",(function(n){var i=a.pointer(n),o=this.id,l=a.select(this).node(),c="rect#"+o,s=a.select(c).node();d(n,t,r,e,l,s,nt.invert(i[0]))})),y){var l=O+H/2+C.top+(O+H)*p[r];n.append("svg:line").attr("class","row-separator").attr("x1",0+C.left).attr("x2",k-C.right).attr("y1",l).attr("y2",l).attr("stroke-width",1).attr("stroke",y)}function m(t,e){return M?C.top+(O+H)*p[r]:C.top}function x(t,e){return M?C.top+(O+H)*p[r]+.75*O:C.top+.75*O}o&&function(t,e,n,r,i){var o=O+H,l=C.top+o/2+o*(e[n]||1);t.append("text").attr("class","timeline-label").attr("transform","translate("+q+","+l+")").text(r?h(i.label):i.id).on("click",(function(e,r){console.log("label click!");var o=a.pointer(e);t.append("rect").attr("id","clickpoint").attr("x",o[0]).attr("width",10).attr("height",O),d(e,r,n,i,o,nt.invert(o[0]))}))}(n,p,r,o,e),void 0!==e.icon&&n.append("image").attr("class","timeline-label").attr("transform","translate(0,"+(C.top+(O+H)*p[r])+")").attr("xlink:href",e.icon).attr("width",C.left).attr("height",O)}))}));var lt=C.top+(O+H)*x,ct=C.top,st=R?ct:lt;if(j&&function(t,e,n){U&&at(t,0,0),$&&it(t),t.append("g").attr("class",et).attr("transform","translate(0,"+n+")").call(e)}(c,rt,st),W&&function(t,e,n){t.append("g").attr("class","axis").attr("transform","translate(0,"+(C.top+(O+H)*n)+")").attr(X.stroke,X.spacing).call(e.tickFormat("").tickSize(-(C.top+(O+H)*(n-1)+3),0,0))}(c,rt,x),k>r.width)var ut=function(t){c.select(".view").attr("transform","translate("+t.transform.x+",0)scale("+t.transform.k+" 1)"),c.selectAll(".timeline-xAxis").attr("transform",(function(e){return"translate("+t.transform.x+", "+st+")scale("+t.transform.k+" 1)"}));var e=t.transform.rescaleX(nt);c.selectAll(".timeline-xAxis").call((function(t){rt.scale(e)}));var n=-t.transform.x;m(n,nt)};if(T){var ft=o.zoom().scaleExtent([0,Y]).translateExtent([[0,0],[k,0]]).on("zoom",ut);n.classed("scrollable",!0).call(ft),c.on("wheel",(function(t){t.preventDefault(),t.stopImmediatePropagation()})),c.on("dblclick.zoom",(function(t){t.preventDefault(),t.stopImmediatePropagation()}))}V&&c.selectAll(".tick text").attr("transform",(function(t){return"rotate("+V+")translate("+(this.getBBox().width/2+10)+","+this.getBBox().height/2+")"}));var dt=c.node().getBoundingClientRect();function mt(t,e){return C.left+(t.starting_time-z)*tt}function ht(t,e){var n=(ht.canvas||(ht.canvas=document.createElement("canvas"))).getContext("2d");return n.font=e,n.measureText(t).width}function gt(t,e,n,r){var i=0;if(t.ending_time&&(i=(t.ending_time-t.starting_time)/2*tt),n&&r){var a=getComputedStyle(document.querySelector(r)),o=ht(n,a.fontSize+" "+a.fontFamily)/2;return C.left+(t.starting_time-z)*tt+i-o}return C.left+(t.starting_time-z)*tt+5}function pt(t,e,n){n=n||"timeline-line",ot.append("svg:line").attr("x1",t).attr("y1",e.marginTop).attr("x2",t).attr("y2",w-e.marginBottom).attr("class",n).style("stroke",e.color).style("stroke-width",e.width)}(function(){if(w||r.height)w?l.node().attr("height",w):w=r.height;else{if(!O)throw"height of the timeline is not set";w=dt.height+dt.top-r.top,a.select(n).node().attr("height",w)}})(),J&&c.each((function(t,e){t.forEach((function(t){t.times.forEach((function(t){pt(nt(t.starting_time),K,Q),pt(nt(t.ending_time),K,Q)}))}))})),Z&&pt(nt(new Date),G)}return ot.margin=function(t){return arguments.length?(C=t,ot):C},ot.orient=function(t){return arguments.length?(v=t,ot):v},ot.itemHeight=function(t){return arguments.length?(O=t,ot):O},ot.itemMargin=function(t){return arguments.length?(H=t,ot):H},ot.navMargin=function(t){return arguments.length?(P=t,ot):P},ot.height=function(t){return arguments.length?(w=t,ot):w},ot.width=function(t){return arguments.length?(k=t,ot):k},ot.display=function(t){return arguments.length&&-1!=c.indexOf(t)?(S=t,ot):S},ot.labelFormat=function(t){return arguments.length?(h=t,ot):h},ot.tickFormat=function(t){return arguments.length?(_=t,ot):_},ot.allowZoom=function(t){return arguments.length?(T=t,ot):T},ot.maxZoom=function(t){return arguments.length?(Y=t,ot):Y},ot.hover=function(t){return arguments.length?(s=t,ot):s},ot.mouseover=function(t){return arguments.length?(u=t,ot):u},ot.mouseout=function(t){return arguments.length?(f=t,ot):f},ot.click=function(t){return arguments.length?(d=t,ot):d},ot.scroll=function(t){return arguments.length?(m=t,ot):m},ot.colors=function(t){return arguments.length?(B=t,ot):B},ot.beginning=function(t){return arguments.length?(z=t,ot):z},ot.ending=function(t){return arguments.length?(I=t,ot):I},ot.labelMargin=function(t){return arguments.length?(q=t,ot):q},ot.labelFloat=function(t){return arguments.length?(g=t,ot):g},ot.rotateTicks=function(t){return arguments.length?(V=t,ot):V},ot.stack=function(){return M=!M,ot},ot.relativeTime=function(){return D=!D,ot},ot.linearTime=function(){return L=!L,ot},ot.showBorderLine=function(){return J=!J,ot},ot.showBorderFormat=function(t){return arguments.length?(K=t,ot):K},ot.showBorderLineClass=function(t){return arguments.length?(Q=t,ot):Q},ot.showToday=function(){return Z=!Z,ot},ot.showTodayFormat=function(t){return arguments.length?(G=t,ot):G},ot.colorProperty=function(t){return arguments.length?(E=t,ot):E},ot.rowSeparators=function(t){return arguments.length?(y=t,ot):y},ot.background=function(t){return arguments.length?(b=t,ot):b},ot.showTimeAxis=function(){return j=!j,ot},ot.showAxisTop=function(){return R=!R,ot},ot.showAxisCalendarYear=function(){return tt=!tt,ot},ot.showTimeAxisTick=function(){return W=!W,ot},ot.fullLengthBackgrounds=function(){return N=!N,ot},ot.showTimeAxisTickFormat=function(t){return arguments.length?(X=t,ot):X},ot.showAxisHeaderBackground=function(t){return U=!U,t&&(A=t),ot},ot.xAxisClass=function(t){return arguments.length?(et=t,ot):et},ot.navigate=function(t,e){return arguments.length?(p=t,x=e,$=!$,ot):[p,x]},ot.version=function(){return"1.0.0"},ot}}));